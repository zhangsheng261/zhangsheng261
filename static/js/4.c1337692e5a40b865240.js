webpackJsonp([4],{"QDA/":function(t,e,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=o("UwjZ"),l=o("/sA3"),i=(o("q00Q"),o("ZpFI")),s=o("Yaes"),r=o("BmLr"),n={components:{imageExport:s.a},props:["dataId","plotlydivId","type","flagType"],data:function(){return{imageFlag:!1,max:0,min:0,colorArr:[{name:"Rainbow",color:["#9966FF","#0000FF","#00FF00","#FFFF00","#FF6600","#FF0000"],scale:[0,.2,.4,.6,.8,1]},{name:"Terrain",color:["#C8D785","#ABD9B1","#7CC478","#75C178","#AFCCA6","#DBD04E","#F1CF0E","#F2A700","#C09F0D","#D3C070","#F0DBA1","#FCECC0","#F8FAEA","#E5FEFA","#DBFFFD","#D6FBFC","#B7F4F7","#73E0F1","#1DBCEF","#0089F5","#0050FA"],scale:[0,.05,.1,.15,.2,.25,.3,.35,.4,.45,.5,.55,.6,.65,.7,.75,.8,.85,.9,.95,1]},{name:"Rainbow2",color:["#000000","#0000FF","#00FFFF","#009900","#FFFF00","#FF0000","#FFFFFF","#FFFFFF"],scale:[0,.11,.26,.49,.59,.8,.96,1]},{name:"Grayscale",color:["#000000","#FFFFFF"],scale:[0,1]},{name:"Jet",color:["#0001FF","#0060FF","#00BEFF","#00F8EC","#19A300","#A7DB00","#FFE600","#FFA200","#FF5F00","#FF9090","#FF1B00"],scale:[0,.1,.2,.3,.4,.5,.6,.7,.8,.9,1]},{name:"Gravity",color:["#FF00FF","#9900CC","#00FFFF","#00FF00","#FFFF00","#FF0000","#FFFFFF"],scale:[0,.15,.35,.55,.64,.78,1]}],Rainbow:["#0001FF","#0060FF","#00BEFF","#00F8EC","#19A300","#A7DB00","#FFE600","#FFA200","#FF5F00","#FF9090","#FF1B00"],RainbowNumber:[0,.1,.2,.3,.4,.5,.6,.7,.8,.9,1],colorArrNow:[],colorScaleNow:[],figure:{title:"专题图名称",xtitle:"Distance/（m）",y1title:"Distance/（m）"},showFlag:!0,Accept:".grd",colourLevelModel:"Jet",colourLevel:[{value:"Jet",img:o("aMwd")},{value:"Rainbow",img:o("ogvo")},{value:"Rainbow2",img:o("vk2z")},{value:"Terrain",img:o("iRWg")},{value:"Grayscale",img:o("R9GL")},{value:"Gravity",img:o("roq9")}],colormap:{Greys:o("cspp"),Picnic:o("7yYV"),Portland:o("Ygyn"),RdBu:o("M053"),Greens:o("M/ie"),Hot:o("VtNA"),Jet:o("aMwd"),Electric:o("XsTw"),Blackbody:o("LI+s"),Bluered:o("scUE"),Viridis:o("FoOO"),YIOrRd:o("NLy3"),YIGnBu:o("pc37"),Earth:o("J1x4")},map2d:"",switch_data:!0,hover_data:!1,slider_data:15,switch_coutourLines:!0,lineWidth:.5,plot_data:[{z:[],x:[],y:[],type:"contour",paper_bgcolor:"none",plot_bgcolor:"none",autoscale:!0,zsmooth:"best",zmax:"",zmin:"",hoverinfo:"none",colorscale:null,contours:{start:"",end:"",size:"",coloring:"contour",showlabels:!0,labelfont:{family:"Raleway",size:12,color:"black"},z:{show:!0,usecolormap:!0,highlightcolor:"#42f462",project:{z:!0}}},line:{width:.5}}],layout:{title:"等值线图",height:this.getHeight(),width:this.getWidth(),margin:{t:50,b:80,l:80,r:0},xaxis:{title:"X",showline:!0,mirror:"allticks",ticks:r.a.state.ticks,exponentformat:"none",autorange:"false",expoents:"none"},yaxis:{title:"Y",showline:!0,mirror:"allticks",expoents:"none",ticks:r.a.state.ticks,exponentformat:"none",autorange:"false",scaleanchor:"x"},annotations:[{showarrow:!1,text:"",x:0,y:0,xref:"paper",yref:"paper"}]},colorDataDefault:[{value:1,color:"rgb(0,1,255)",action:"删除"},{value:2,color:"rgb(0,96,255)",action:"删除"},{value:3,color:"rgb(0,190,255)",action:"删除"},{value:4,color:"rgb(0,248,236)",action:"删除"},{value:5,color:"rgb(0,223,174)",action:"删除"},{value:6,color:"rgb(0,198,113)",action:"删除"},{value:7,color:"rgb(0,174,51)",action:"删除"},{value:8,color:"rgb(25,163,0)",action:"删除"},{value:9,color:"rgb(167,219,0)",action:"删除"},{value:10,color:"rgb(255,230,0)",action:"删除"},{value:11,color:"rgb(255,162,0)",action:"删除"},{value:12,color:"rgb(255,95,0)",action:"删除"},{value:13,color:"rgb(255,53,53)",action:"删除"},{value:14,color:"rgb(255,144,144)",action:"删除"},{value:15,color:"rgb(255,230,230)",action:"删除"}],colorData:[],valueForColor:0,reviseValueForColor:0,colorCount:18,customColor:"#19be6b",reviseCustomColor:"#19be6b",grdData:null,dataAll:null,isColourLevelSettingsVisible:!1,isColorTableVisible:!1,isReviseColorTableVisible:!1,isFigureVisible:!1,colorTableToProject:[],switchOpeConFlag:"展开",contourLineSetting:!0,plotlydiv:null,z_ScaleValue:[],z_ScaleColor:[],colorDataProject:[],reviseColorTableIndex:null,minValue:0,maxValue:0,initColorTableFlag:!0}},methods:{colorCountChange:function(){},changeType:function(t){if(this.plot_data[0].type=t,"contour"==t)this.layout.title="等值线图",this.showContour(!0),this.$Plotly.react(this.plotlydiv,this.plot_data,this.layout);else if("heatmap"==t)this.layout.title="影像图",this.showContour(!1),this.$Plotly.react(this.plotlydiv,this.plot_data,this.layout);else if("surface"==t){this.showContour(!1),this.layout.title="三维图";this.plot_data[0].x,this.plot_data[0].y,this.plot_data[0].z;this.$Plotly.react(this.plotlydiv,this.plot_data,this.layout)}},changeRender:function(t){this.$nextTick(function(){this.contourLineSetting="lines"!=t&&"heatmap"!=t}),this.plot_data[0].contours.coloring=t,this.$Plotly.react(this.plotlydiv,this.plot_data,this.layout)},slider_widthChange:function(){this.plot_data[0].line.width=this.lineWidth,this.$Plotly.react(this.plotlydiv,this.plot_data,this.layout)},switch_cLines:function(t){1==t?(this.$Message.info(window.vm.$i18n.t("linesMap.lineShow")),this.plot_data[0].contours.showlines=!0):(this.$Message.info(window.vm.$i18n.t("linesMap.lineClose")),this.plot_data[0].contours.showlines=!1),this.$Plotly.react(this.plotlydiv,this.plot_data,this.layout)},changeColourLevel:function(t){for(var e=0;e<this.colorArr.length;e++)if(this.colorArr[e].name==t){this.colorArrNow=this.colorArr[e].color,this.colorScaleNow=this.colorArr[e].scale;break}},changeFigure:function(){var t={title:this.figure.title,"xaxis.title":this.figure.xtitle,"yaxis.title":this.figure.y1title};this.$Plotly.relayout(this.plotlydiv,t)},changeColor:function(t){this.plot_data[0].colorscale=t,this.$Plotly.react(this.plotlydiv,this.plot_data,this.layout)},showContour:function(t){this.showFlag=!!t},slider_change:function(){},switch_change:function(t){1==t?(this.$Message.info(window.vm.$i18n.t("linesMap.markShow")),this.plot_data[0].contours.showlabels=!0):(this.$Message.info(window.vm.$i18n.t("linesMap.markClose")),this.plot_data[0].contours.showlabels=!1),this.$Plotly.react(this.plotlydiv,this.plot_data,this.layout)},hover_change:function(t){1==t?(this.$Message.info(window.vm.$i18n.t("linesMap.hoverShow")),this.plot_data[0].hoverinfo="x+y+z"):(this.$Message.info(window.vm.$i18n.t("linesMap.hoverClose")),this.plot_data[0].hoverinfo="none"),this.$Plotly.react(this.plotlydiv,this.plot_data,this.layout)},switchState:function(t){},getWidth:function(){return window.innerWidth-280},getHeight:function(){return window.innerHeight-200},initPage:function(){var t=this.dataId;void 0!=t&&l.a.getJsonFromDatabase(t,this.initContourMap)},initContourMap:function(t){this.min=t.grdData.zmin.toFixed(2),this.max=t.grdData.zmax.toFixed(2),this.colorArrNow=this.Rainbow,this.colorScaleNow=this.RainbowNumber,this.grdData=t.grdData,this.dataAll=t,this.grdData&&this.initColorTable(this.grdData),this.plot_data[0].x=t.grdData.x,this.plot_data[0].y=t.grdData.y,this.plot_data[0].z=t.grdData.z;var e=this.colorData.map(function(t){return t.value});this.plot_data[0].type=this.type,this.plot_data[0].contours.start=e[0],this.plot_data[0].contours.end=e[e.length-1],this.plot_data[0].contours.size=(e[e.length-1]-e[0])/(e.length-1),this.plotlydiv=document.getElementById(this.plotlydivId);var o=this.getWidth()-80,a=this.getHeight()-130,l=t.grdData.xmax-t.grdData.xmin,i=t.grdData.ymax-t.grdData.ymin;if(l/i<=.926*o/a){var s=(o-a*l/i)/2;this.layout.margin.l=80+s,this.layout.margin.r=s}else{var r=(a-.92*o*i/l)/2;this.layout.margin.t=50+r,this.layout.margin.b=80+r}if(t.colorConfig){this.plot_data[0].colorscale=t.colorConfig.colorscale,this.plot_data[0].contours=t.colorConfig.contours,this.slider_data=t.colorConfig.colorscale.length-1,this.colourLevelModel=t.colorConfig.colourLevelModel,this.minValue=parseFloat(t.colorConfig.contours.start),this.maxValue=parseFloat(t.colorConfig.contours.end);for(var n=[],c=0;c<t.colorConfig.colorscale.length;c++)n.push({value:(this.minValue+c*parseFloat(t.colorConfig.contours.size)).toFixed(2),color:t.colorConfig.colorscale[c][1],action:"删除"});this.colorData=n}this.$Plotly.newPlot(this.plotlydiv,this.plot_data,this.layout,{scrollZoom:!0,displaylogo:!1,modeBarButtonsToRemove:["toImage","zoomIn2d","zoomOut2d","toggleSpikelines","hoverClosestCartesian","hoverCompareCartesian"]}),this.changeType(this.type)},sort:function(t){for(var e=0;e<t.length-1;e++)for(var o=0;o<t.length-1-e;o++)if(t[o]>t[o+1]){var a=t[o];t[o]=t[o+1],t[o+1]=a}},initColorTable:function(t){if(this.minValue=parseFloat(t.zmin).toFixed(2),this.maxValue=parseFloat(t.zmax).toFixed(2),this.z_ScaleColor=[],this.z_ScaleValue=[],"0"==this.flagType){this.slider_data=19;var e=t.zmax-t.zmin;this.z_ScaleValue.push((.005*e+t.zmin).toFixed(2)),this.z_ScaleValue.push((.012*e+t.zmin).toFixed(2)),this.z_ScaleValue.push((.02*e+t.zmin).toFixed(2)),this.z_ScaleValue.push((.03*e+t.zmin).toFixed(2)),this.z_ScaleValue.push((.045*e+t.zmin).toFixed(2)),this.z_ScaleValue.push((.08*e+t.zmin).toFixed(2)),this.z_ScaleValue.push((.15*e+t.zmin).toFixed(2)),this.z_ScaleValue.push((.25*e+t.zmin).toFixed(2)),this.z_ScaleValue.push((.4*e+t.zmin).toFixed(2)),this.z_ScaleValue.push((.6*e+t.zmin).toFixed(2)),this.z_ScaleValue.push((.75*e+t.zmin).toFixed(2)),this.z_ScaleValue.push((.85*e+t.zmin).toFixed(2)),this.z_ScaleValue.push((.92*e+t.zmin).toFixed(2)),this.z_ScaleValue.push((.955*e+t.zmin).toFixed(2)),this.z_ScaleValue.push((.97*e+t.zmin).toFixed(2)),this.z_ScaleValue.push((.98*e+t.zmin).toFixed(2)),this.z_ScaleValue.push((.988*e+t.zmin).toFixed(2)),this.z_ScaleValue.push((.995*e+t.zmin).toFixed(2)),this.z_ScaleValue.push((e+t.zmin).toFixed(2))}else for(var o=(t.zmax-t.zmin)/this.slider_data,l=0;l<=this.slider_data;l++){var i=(l*o+t.zmin).toFixed(2);this.z_ScaleValue.push(i)}function s(t){if("#"==t.charAt(0))return t;var e=t.split(/\D+/);return"#"+function(t,e){for(var o=t.toString(16);o.length<e;)o="0"+o;return o}(65536*Number(e[1])+256*Number(e[2])+Number(e[3]),6)}for(var r=0;r<this.z_ScaleValue.length;r++)for(var n=r/(this.z_ScaleValue.length-1),c=0;c<this.colorScaleNow.length;c++)if(!(n>this.colorScaleNow[c])){if(n==this.colorScaleNow[c]){this.z_ScaleColor.push([n,this.colorArrNow[c]]);break}var u=(n-this.colorScaleNow[c-1])/(this.colorScaleNow[c]-this.colorScaleNow[c-1]),h=a.a.gradientColor(s(this.colorArrNow[c-1]),s(this.colorArrNow[c]),u);this.z_ScaleColor.push([n,h[0]]);break}this.plot_data[0].colorscale=this.z_ScaleColor;for(var p=[],d=0;d<this.z_ScaleColor.length;d++)p.push({value:this.z_ScaleValue[d],color:this.z_ScaleColor[d][1],action:"删除"});this.colorData=p},clearColorItem:function(){this.colorData=[]},defaultColorRender:function(){this.colorArrNow=this.Rainbow,this.colorScaleNow=this.RainbowNumber,15==this.slider_data?this.initColorTable(this.grdData):this.slider_data=15},addColorItem:function(){if(-1==this.colorData.map(function(t){return t.value}).indexOf(this.valueForColor)){var t=void 0,e=this.grdData.zmax-this.grdData.zmin,o=(this.valueForColor-this.grdData.zmin)/e,l=this.valueForColor/this.grdData.zmax;if(o<0||o>1)this.$Notice.warning({title:"错误添加",desc:"值不存在！",duration:.5});else{for(var i=0;i<this.RainbowNumber.length;i++)if(!(l>this.RainbowNumber[i])){if(l==this.RainbowNumber[i]){this.z_ScaleColor.push([o,this.Rainbow[i]]);break}var s=(l-this.RainbowNumber[i-1])/(this.RainbowNumber[i]-this.RainbowNumber[i-1]);t=a.a.gradientColor(this.Rainbow[i-1],this.Rainbow[i],s),this.z_ScaleColor.push([o,t[0]]);break}this.plot_data[0].colorscale=this.z_ScaleColor,this.colorData.push({value:this.valueForColor,color:t[0],action:"删除"}),this.colorData.sort(function(t,e){return t.value-e.value})}}else this.$Notice.warning({title:"重复添加",desc:"值已存在！",duration:.5})},applyColourLevelSettings:function(){this.colourLevelModel&&(this.plot_data[0].colorscale=this.colourLevelModel);var t=this.grdData.zmin,e=this.grdData.zmax,o=(e-t)/(this.slider_data-1);this.plot_data[0].contours.start=t,this.plot_data[0].contours.end=e,this.plot_data[0].contours.size=o,this.$Plotly.react(this.plotlydiv,this.plot_data,this.layout)},applyCustomColor:function(){if(parseFloat(this.minValue)<parseFloat(this.min)||parseFloat(this.maxValue)>parseFloat(this.max))this.$message({type:"warning",message:window.vm.$i18n.t("compareMap.outLimit")+window.vm.$i18n.t("compareMap.min")+parseFloat(this.min).toFixed(2)+window.vm.$i18n.t("compareMap.max")+parseFloat(this.max).toFixed(2)});else{if(this.initColorTableFlag){var t={zmin:parseFloat(this.minValue),zmax:parseFloat(this.maxValue)};this.initColorTable(t)}var e=this.colorData.map(function(t){return t.value});this.plot_data[0].contours.start=e[0],this.plot_data[0].contours.end=e[e.length-1],this.plot_data[0].contours.size=(this.plot_data[0].contours.end-this.plot_data[0].contours.start)/(this.colorData.length-1);for(var o,a=e[0],l=[],i=e[e.length-1]-a,s=!1,r=0;r<this.colorData.length;r++){var n=(this.colorData[r].value-a)/i;0!=n&&0==r?l.push([0,this.colorData[r].color]):r==this.colorData.length-1&&1!=n&&n<=1?l.push([1,this.colorData[r].color]):n>1?s?l.push([1,o]):(l.push([1,this.colorData[r].color]),o=this.colorData[r].color,s=!0):n<0?l.push([0,this.colorData[r].color]):l.push([n,this.colorData[r].color])}this.plot_data[0].colorscale=l,this.$Plotly.react(this.plotlydiv,this.plot_data,this.layout);var c=this.dataAll;c.colorConfig={},c.colorConfig.colorscale=l,c.colorConfig.contours=this.plot_data[0].contours,c.colorConfig.colourLevelModel=this.colourLevelModel,this.$store.state.LocalDB.db.updateData(this.dataId,c,function(){})}},ParameterCalculation:function(){if(this.initColorTableFlag=!0,parseFloat(this.minValue)<parseFloat(this.min)||parseFloat(this.maxValue)>parseFloat(this.max))this.$message({type:"warning",message:window.vm.$i18n.t("compareMap.outLimit")+window.vm.$i18n.t("compareMap.min")+parseFloat(this.min).toFixed(2)+window.vm.$i18n.t("compareMap.max")+parseFloat(this.max).toFixed(2)});else if(this.initColorTableFlag){var t={zmin:parseFloat(this.minValue),zmax:parseFloat(this.maxValue)};this.initColorTable(t)}},applyReviseCustomColor:function(){if(parseFloat(this.reviseValueForColor)<parseFloat(this.min)||parseFloat(this.reviseValueForColor)>parseFloat(this.max))this.$message({type:"warning",message:window.vm.$i18n.t("compareMap.outLimit")+window.vm.$i18n.t("compareMap.min")+parseFloat(this.min).toFixed(2)+window.vm.$i18n.t("compareMap.max")+parseFloat(this.max).toFixed(2)});else{var t=this.colorData.map(function(t){return t.value});this.colorData.map(function(t){return t.color});-1==t.indexOf(this.reviseValueForColor)||this.reviseValueForColor==this.colorData[this.reviseColorTableIndex].value?(this.z_ScaleColor[this.reviseColorTableIndex][1]=this.reviseCustomColor,this.z_ScaleColor.sort(function(t,e){return t[0]-e[0]}),this.colorData[this.reviseColorTableIndex].value=this.reviseValueForColor,this.colorData[this.reviseColorTableIndex].color=this.reviseCustomColor,this.colorData.sort(function(t,e){return t.value-e.value}),this.plot_data[0].colorscale=this.z_ScaleColor):this.$Notice.warning({title:"重复添加",desc:"值已存在！",duration:.5})}},closeColorTable:function(){this.isColorTableVisible=!1},openColorScale:function(){this.isColourLevelSettingsVisible=!0},openColorTable:function(){this.isColorTableVisible=!0},openFigureTable:function(){this.isFigureVisible=!0},deleteColorTableRow:function(t){this.initColorTableFlag=!1,this.colorData.splice(t,1)},reviseColorTableRow:function(t){this.initColorTableFlag=!1,this.isReviseColorTableVisible=!0,this.reviseColorTableIndex=t,this.reviseValueForColor=this.colorData[this.reviseColorTableIndex].value,this.reviseCustomColor=this.colorData[this.reviseColorTableIndex].color},projectToMap:function(t){var e=this;l.a.getJsonFromDatabase(e.dataId,function(o){e.dataAll=o,"Null"!=e.dataAll.spatialReference?"projectTo2D"==t?e.projectTo2D():e.projectTo3D():e.$message({type:"warning",message:window.vm.$i18n.t("message.noCoornate")})})},projectTo2D:function(){this.$message({message:window.vm.$i18n.t("message.handlling"),type:"success"}),this.projectTo2Dand3D("2d")},projectTo3D:function(){this.$message({message:window.vm.$i18n.t("message.handlling"),type:"success"}),this.projectTo2Dand3D("3d")},projectTo2Dand3D:function(t){var e=this;e.$store.state.Global.percent=0,e.$store.state.Global.progressVisible=!0,l.a.changeSpatialReference(e.dataAll.spatialReference);for(var o,a=e.dataAll.data,s={traindata:[],datainterval:[],bounds:[],size:[]},r=[],n=[],c=[],u=99999,h=9999,p=0,d=0,v=!1,m=0;o=a[m++];){var g=[o.x,o.y],f=null;f="EPSG:4326"==e.dataAll.spatialReference?[o.x,o.y]:e.ol.proj.transform(g,e.dataAll.spatialReference,"EPSG:4326"),r.push(f[0]),n.push(f[1]),"NaN"==o.z?(c.push(1e6),v=!0):c.push(o.z),f[0]<u&&(u=f[0]),f[0]>p&&(p=f[0]),f[1]<h&&(h=f[1]),f[1]>d&&(d=f[1])}setTimeout(function(){100!=e.$store.state.Global.percent&&(e.$store.state.Global.percent=45)},1e3),s.traindata[0]=r,s.traindata[1]=n,s.traindata[2]=c,s.bounds[0]=u,s.bounds[1]=h,s.bounds[2]=p,s.bounds[3]=d,s.datainterval=e.colorData.map(function(t){return t.value}),s.datainterval.push(-1e5);var b=[];e.colorData.forEach(function(t){var e={};e.color=t.color,e.value=t.value,b.push(e)});for(var w=0;w<b.length;w++)0!=w?w!=b.length-1?b[w].value=e.colorData[w-1].value+"~"+e.colorData[w].value:b[w].value="> "+e.colorData[w].value:b[w].value="< "+e.colorData[w].value;e.$nextTick(function(){e.$store.state.Global.legendsOfProjectedMap=b,e.$store.state.Global.legendsOfProjectedMapVisible=!0}),e.colorDataProject=e.colorData,v&&(s.datainterval.push(1e6),e.colorDataProject.push({value:1e6,color:""})),s.datainterval.sort(function(t,e){return t-e}),s.size=[e.dataAll.grdData.xcount,e.dataAll.grdData.ycount],e.dataAll.clipGeo&&(s.isclip=!0,s.ClipGeo=e.dataAll.clipGeo),s.smooth=!1,setTimeout(function(){100!=e.$store.state.Global.percent&&(e.$store.state.Global.percent=60)},2500),e.axios.post(WebConfig.ServicesUrl+"/GetCountourPolygon",s).then(function(o){var a=[];if("ERROR"!=o.data.status){var l=JSON.parse(o.data.data);if("2d"==t){var r=i.a.treeData2d[1].children.map(function(t){return t.id});r.sort(function(t,e){return t-e});var n=new e.ol.source.Vector({features:(new e.ol.format.GeoJSON).readFeatures(l)}),c=100+Math.floor(10*Math.random());0!=r.length&&(c=r[r.length-1]+1);var m=null,g=new e.ol.layer.Vector({id:c,source:n,style:function(t){var o=t.get("lvalue");if(-1!=a.indexOf(o)||a.push(o),v&&1e6==o){i=new e.ol.style.Style({fill:new e.ol.style.Fill({color:"rgb(0,0,0,0)"})});return i}if(v&&o==s.datainterval[s.datainterval.length-2]){i=new e.ol.style.Style({fill:new e.ol.style.Fill({color:"rgb(0,0,0,0)"})});return i}for(var l=0;l<e.colorDataProject.length;l++){if(l==e.colorDataProject.length-1){m=e.colorDataProject[l];break}if(parseFloat(e.colorDataProject[l].value)<=o&&parseFloat(e.colorDataProject[l+1].value)>o){m=e.colorDataProject[l+1];break}}var i=new e.ol.style.Style({fill:new e.ol.style.Fill({color:m.color}),text:new e.ol.style.Text({text:(1*o).toFixed(2)+""})});return i}});a.sort(),console.log(a);var f={};f.id=c,f.label=window.vm.$i18n.t("linesMap.resultName")+"_"+e.dataAll.displayName,f.layerObj=n,f.shareObj={json:l,colorConfig:e.colorDataProject};for(var b=0;b<e.colorDataProject.length;b++)1e6==parseFloat(e.colorDataProject[b].value)&&e.colorDataProject.splice(b,1);i.a.treeData2d[1].children.push(f),e.$nextTick(function(){e.$store.state.Global.twoDLayerTree.setChecked(c,!0,!1)}),setTimeout(function(){100!=e.$store.state.Global.percent&&(e.$store.state.Global.percent=100)},2e3),setTimeout(function(){e.$store.state.Global.progressVisible=!1},2500),e.$store.state.Global.map2DHandler.addLayer(g),e.$store.state.Global.map2DHandler.getView().fit(n.getExtent()),e.$store.state.Global.activeTabValue="二维地图",e.$store.state.Global.twoDTempLayers.push(g),e.$message({message:window.vm.$i18n.t("linesMap.projectSuccess"),type:"success"})}else if("3d"==t){var w={camera:e.$store.state.Global.map3DHandler.scene.camera,canvas:e.$store.state.Global.map3DHandler.scene.canvas,clampToGround:!0};e.$store.state.Global.Cesium.GeoJsonDataSource.load(l,w).then(function(t){e.$store.state.Global.map3DHandler.dataSources.add(t);for(var o=t.entities.values,a=0;a<o.length;a++){var l=o[a],s=l.properties.hvalue._value,r=e.colorData.find(function(t){return t.value==s});l.polygon&&(l.polygon.material=e.$store.state.Global.Cesium.Color.fromCssColorString(r.color),l.polygon.outlineColor=e.$store.state.Global.Cesium.Color.WHITE)}e.$store.state.Global.activeTabValue="三维地图";var n=e.$store.state.Global.map3DHandler.entities.add({position:e.Cesium.Cartesian3.fromDegrees((u+p)/2,(h+d)/2),point:{pixelSize:1,color:e.Cesium.Color.YELLOW}}),c=200+Math.floor(10*Math.random()),v={};v.id=c,v.label=window.vm.$i18n.t("linesMap.resultName")+"_"+v.id,v.imageryLayer=t,v.viewEntity=n,v.visible=!0,i.a.treeData3d[1].children.push(v),e.$message({message:window.vm.$i18n.t("linesMap.projectSuccess"),type:"success"})})}}else e.$Message.info("后台数据处理异常")}).catch(function(t){console.log(t),e.$store.state.Global.progressVisible=!1,e.$store.state.Global.percent=0,e.$Message.info("后台服务连接异常")})},importConfig:function(t){var e=this,o=new FileReader;o.readAsText(t),o.onload=function(){var t=this.result.replace(/\r|\n/," ").split(/\s+/);e.slider_data=t[1];for(var o=[],a=2;a<t.length;a+=2){var l={value:t[a],color:t[a+1],action:"删除"};o.push(l)}e.colorData=o,e.applyCustomColor()}},setConfig:function(t){if("importConfig"==t);else if("exportConfig"==t){var e="";e+="slider_data "+this.slider_data+"\r\n";for(var o=0;o<this.colorData.length;o++)e+=this.colorData[o].value+" "+this.colorData[o].color+"\r\n";e=e.substring(0,e.lastIndexOf("\r\n"));var a=new Blob([e],{type:"text/plain;charset=utf-8"});saveAs(a,"contourMap.config")}},switchOpeStatus:function(t){"展开"==this.switchOpeConFlag?(this.$refs.opeConRef.style.width="0",this.$refs.opeConRef.style.overflow="hidden",this.switchOpeConFlag="隐藏"):"隐藏"==this.switchOpeConFlag&&(this.$refs.opeConRef.style.width="unset",this.$refs.opeConRef.style.overflow="unset",this.switchOpeConFlag="展开")},showModal:function(){this.imageFlag=!0},closeModal:function(t){this.imageFlag=t},initColorScales:function(){for(var t=this.$store.state.Global.colorscales,e=0;e<t.length;e++){for(var o={value:t[e].name,img:t[e].img},a={name:t[e].name,color:[],scale:[]},l=0;l<t[e].value.length;l++)a.scale.push(t[e].value[l][0]),a.color.push(t[e].value[l][1]);this.colormap[t[e].name]=t[e].img,this.colorArr.push(a),this.colourLevel.push(o)}}},watch:{colourLevelModel:function(t,e){this.changeColourLevel(t)}},computed:{thematicFlag:function(){return this.$store.state.Global.thematicFlag},colorColumn:function(){var t=this;return[{title:window.vm.$i18n.t("linesMap.setColor.value"),key:"value",render:function(t,e){return t("div",{},e.row.value)}},{title:window.vm.$i18n.t("linesMap.setColor.color"),key:"color",render:function(t,e){return t("div",[t("div",{style:{color:"#19be6b",background:e.row.color,width:"90px",height:"20px"},on:{click:function(){}}})])}},{title:window.vm.$i18n.t("linesMap.setColor.handle"),key:"action",align:"center",render:function(e,o){return e("div",[e("Button",{props:{type:"primary",size:"small"},style:{marginRight:"5px"},on:{click:function(){t.reviseColorTableRow(o.index)}}},window.vm.$i18n.t("linesMap.setColor.operate")),e("Button",{props:{type:"error",size:"small"},on:{click:function(){t.deleteColorTableRow(o.index)}}},window.vm.$i18n.t("linesMap.setColor.delete"))])}}]}},mounted:function(){this.initColorScales(),this.initPage()}},c={render:function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",[o("div",{staticClass:"headerOpeBanner"},[o("el-button",{staticClass:"switchContainer",staticStyle:{padding:"5px 10px"},attrs:{plain:"",size:"mini",title:"菜单 展开/收缩"},on:{click:t.switchOpeStatus}},[o("i",{staticClass:"el-icon-arrow-left",class:{transition:"展开"!=this.switchOpeConFlag}})]),t._v(" "),o("div",{ref:"opeConRef",staticClass:"operationContainerWrap"},[o("div",{staticClass:"counterMenuGroup operationContainer",style:{width:.7*this.getWidth()+"px"}},[o("span",[o("Dropdown",{staticClass:"menubutton",on:{"on-click":t.changeType}},[o("el-button",{attrs:{type:"primary",size:"mini"}},[t._v("\n                                    "+t._s(t.$t("linesMap.mapType.title"))+"\n                                    "),o("Icon",{attrs:{type:"ios-arrow-down"}})],1),t._v(" "),o("DropdownMenu",{attrs:{slot:"list"},slot:"list"},[o("DropdownItem",{attrs:{name:"contour"}},[t._v(t._s(t.$t("linesMap.mapType.contour")))]),t._v(" "),o("DropdownItem",{attrs:{name:"heatmap"}},[t._v(t._s(t.$t("linesMap.mapType.heatmap")))])],1)],1),t._v(" "),o("Dropdown",{staticClass:"menubutton",style:{display:1==this.showFlag?"block":"none"},on:{"on-click":t.changeRender}},[o("el-button",{attrs:{size:"mini",type:"primary"}},[t._v("\n                                    "+t._s(t.$t("linesMap.RenderType.title"))+"\n                                    "),o("Icon",{attrs:{type:"ios-arrow-down"}})],1),t._v(" "),o("DropdownMenu",{attrs:{slot:"list"},slot:"list"},[o("DropdownItem",{attrs:{name:"contour"}},[t._v(t._s(t.$t("linesMap.RenderType.contour")))]),t._v(" "),o("DropdownItem",{attrs:{name:"lines"}},[t._v(t._s(t.$t("linesMap.RenderType.lines")))]),t._v(" "),o("DropdownItem",{attrs:{name:"heatmap"}},[t._v(t._s(t.$t("linesMap.RenderType.heatmap")))])],1)],1),t._v(" "),o("span",{staticClass:"menubutton",staticStyle:{display:"none"}},[o("el-button",{staticStyle:{"vertical-align":"middle"},attrs:{size:"mini",type:"primary"},on:{click:function(e){return t.switchState("/map2d")}}},[t._v("地图投影")])],1)],1),t._v(" "),t.thematicFlag?o("el-button",{staticClass:"menubutton",attrs:{type:"primary",size:"mini"},on:{click:t.openFigureTable}},[t._v(t._s(t.$t("linesMap.styleModify.title")))]):t._e(),t._v(" "),o("el-button",{staticClass:"menubutton",attrs:{type:"primary",size:"mini"},on:{click:t.openColorTable}},[t._v(t._s(t.$t("linesMap.setColor.title")))]),t._v(" "),t._e(),t._v(" "),o("Dropdown",{staticClass:"menubutton",on:{"on-click":t.projectToMap}},[o("el-button",{attrs:{size:"mini",type:"primary"}},[t._v("\n              "+t._s(t.$t("linesMap.project.title"))+"\n              "),o("Icon",{attrs:{type:"ios-arrow-down"}})],1),t._v(" "),o("DropdownMenu",{attrs:{slot:"list"},slot:"list"},[o("DropdownItem",{attrs:{name:"projectTo2D"}},[t._v(t._s(t.$t("linesMap.project.projectTo2d")))])],1)],1),t._v(" "),o("span",{staticClass:"menubutton",style:{display:1==this.showFlag?"inline":"none"}},[t.contourLineSetting?o("span",[t._v("\n                                "+t._s(t.$t("linesMap.contour"))+"\n                                "),o("i-switch",{on:{"on-change":t.switch_cLines},model:{value:t.switch_coutourLines,callback:function(e){t.switch_coutourLines=e},expression:"switch_coutourLines"}})],1):t._e(),t._v("\n                            "+t._s(t.$t("linesMap.tagging"))+"\n                            "),o("i-switch",{on:{"on-change":t.switch_change},model:{value:t.switch_data,callback:function(e){t.switch_data=e},expression:"switch_data"}}),t._v("\n                            "+t._s(t.$t("linesMap.hover"))+"\n                            "),o("i-switch",{on:{"on-change":t.hover_change},model:{value:t.hover_data,callback:function(e){t.hover_data=e},expression:"hover_data"}}),t._v("\n                            "+t._s(t.$t("linesMap.lineWide"))+"\n                            "),o("Slider",{staticStyle:{width:"100px",display:"inline-block","vertical-align":"middle"},attrs:{min:.5,max:2,step:.1},on:{"on-change":t.slider_widthChange},model:{value:t.lineWidth,callback:function(e){t.lineWidth=e},expression:"lineWidth"}})],1),t._v("\n           \n          "),o("el-button",{staticStyle:{"margin-right":"10px"},attrs:{type:"primary",size:"mini"},on:{click:t.showModal}},[t._v("\n            "+t._s(t.$t("linesMap.exportImage"))+"\n          ")])],1)])],1),t._v(" "),o("imageExport",{attrs:{imageConfigShow:t.imageFlag,plotlyDiv:t.plotlydiv},on:{closeModal:t.closeModal}}),t._v(" "),o("Modal",{attrs:{draggable:"",title:"色阶设置",width:"420"},on:{"on-ok":t.applyColourLevelSettings},model:{value:t.isColourLevelSettingsVisible,callback:function(e){t.isColourLevelSettingsVisible=e},expression:"isColourLevelSettingsVisible"}},[o("Row",{staticStyle:{margin:"5px",border:"solid aliceblue 1px",padding:"5px"}},[o("Col",{attrs:{span:"8"}},[o("P",{staticStyle:{"font-size":"15px","margin-top":"5px"}},[t._v("色阶数：")])],1),t._v(" "),o("Col",[o("Slider",{staticStyle:{width:"100px",display:"inline-block","vertical-align":"middle"},attrs:{min:10,max:20},on:{"on-change":t.slider_change},model:{value:t.slider_data,callback:function(e){t.slider_data=e},expression:"slider_data"}})],1)],1),t._v(" "),o("Row",{staticStyle:{margin:"5px",border:"solid aliceblue 1px",padding:"5px"}},[o("Col",{attrs:{span:"8"}},[o("P",{staticStyle:{"font-size":"15px","margin-top":"5px"}},[t._v("色阶设置：")])],1),t._v(" "),o("Col",[o("Select",{staticStyle:{width:"200px"},on:{"on-change":t.changeColourLevel},model:{value:t.colourLevelModel,callback:function(e){t.colourLevelModel=e},expression:"colourLevelModel"}},t._l(t.colourLevel,function(e){return o("Option",{key:e.value,attrs:{value:e.value}},[o("img",{attrs:{src:e.img}}),t._v(t._s(e.value))])}),1)],1)],1)],1),t._v(" "),o("Modal",{attrs:{cancelText:t.$t("button.cancel"),okText:t.$t("button.ok"),draggable:"",title:t.$t("linesMap.styleModify.title"),width:"420"},on:{"on-ok":t.changeFigure},model:{value:t.isFigureVisible,callback:function(e){t.isFigureVisible=e},expression:"isFigureVisible"}},[o("Row",{staticStyle:{margin:"5px",border:"solid aliceblue 1px",padding:"5px"}},[o("el-row",{staticStyle:{"margin-bottom":"10px"},attrs:{gutter:5,type:"flex"}},[o("el-col",{attrs:{span:2}}),t._v(" "),o("el-col",{attrs:{span:6}},[o("span",{staticClass:"geo-dialog-lable"},[t._v(t._s(t.$t("linesMap.styleModify.name")))])]),t._v(" "),o("el-col",{attrs:{span:14}},[o("el-input",{attrs:{size:"small"},model:{value:t.figure.title,callback:function(e){t.$set(t.figure,"title",e)},expression:"figure.title"}})],1)],1),t._v(" "),o("el-row",{staticStyle:{"margin-bottom":"10px"},attrs:{gutter:5,type:"flex"}},[o("el-col",{attrs:{span:2}}),t._v(" "),o("el-col",{attrs:{span:6}},[o("span",{staticClass:"geo-dialog-lable"},[t._v(t._s(t.$t("linesMap.styleModify.X1Title")))])]),t._v(" "),o("el-col",{attrs:{span:14}},[o("el-input",{attrs:{size:"small"},model:{value:t.figure.xtitle,callback:function(e){t.$set(t.figure,"xtitle",e)},expression:"figure.xtitle"}})],1)],1),t._v(" "),o("el-row",{staticStyle:{"margin-bottom":"10px"},attrs:{gutter:5,type:"flex"}},[o("el-col",{attrs:{span:2}}),t._v(" "),o("el-col",{attrs:{span:6}},[o("span",{staticClass:"geo-dialog-lable"},[t._v(t._s(t.$t("linesMap.styleModify.Y1Title")))])]),t._v(" "),o("el-col",{attrs:{span:14}},[o("el-input",{attrs:{size:"small"},model:{value:t.figure.y1title,callback:function(e){t.$set(t.figure,"y1title",e)},expression:"figure.y1title"}})],1)],1)],1)],1),t._v(" "),o("Modal",{attrs:{cancelText:t.$t("button.cancel"),okText:t.$t("button.ok"),draggable:"",title:t.$t("linesMap.setColor.title"),width:"460"},on:{"on-ok":t.applyCustomColor},model:{value:t.isColorTableVisible,callback:function(e){t.isColorTableVisible=e},expression:"isColorTableVisible"}},[o("el-alert",{attrs:{title:t.$t("linesMap.setColor.tips"),type:"info"}}),t._v(" "),o("Row",{staticStyle:{margin:"5px",border:"solid aliceblue 1px",padding:"5px"}},[o("Col",{attrs:{span:"5"}},[o("P",{staticStyle:{"font-size":"15px","margin-top":"5px"}},[t._v(t._s(t.$t("linesMap.setColor.min")))])],1),t._v(" "),o("Col",{attrs:{span:"6"}},[o("Input",{attrs:{number:!0},model:{value:t.minValue,callback:function(e){t.minValue=e},expression:"minValue"}})],1),t._v(" "),o("Col",{attrs:{span:"5"}},[o("P",{staticStyle:{"font-size":"15px","margin-top":"5px","margin-left":"5px"}},[t._v(t._s(t.$t("linesMap.setColor.max")))])],1),t._v(" "),o("Col",{attrs:{span:"6"}},[o("Input",{attrs:{number:!0},model:{value:t.maxValue,callback:function(e){t.maxValue=e},expression:"maxValue"}})],1)],1),t._v(" "),o("Row",{staticStyle:{margin:"5px",border:"solid aliceblue 1px",padding:"5px"}},[o("Col",{attrs:{span:"8"}},[o("P",{staticStyle:{"font-size":"15px","margin-top":"5px"}},[t._v(t._s(t.$t("linesMap.setColor.colorNum")))])],1),t._v(" "),o("Col",[o("Slider",{staticStyle:{width:"100px",display:"inline-block","vertical-align":"middle"},attrs:{min:10,max:20},on:{"on-input":t.slider_change},model:{value:t.slider_data,callback:function(e){t.slider_data=e},expression:"slider_data"}})],1)],1),t._v(" "),o("Row",{staticStyle:{margin:"5px",border:"solid aliceblue 1px",padding:"5px"}},[o("Col",{attrs:{span:"8"}},[o("P",{staticStyle:{"font-size":"15px","margin-top":"5px"}},[t._v(t._s(t.$t("linesMap.setColor.reference")))])],1),t._v(" "),o("Col",[o("Select",{staticStyle:{width:"200px"},on:{"on-change":t.changeColourLevel},model:{value:t.colourLevelModel,callback:function(e){t.colourLevelModel=e},expression:"colourLevelModel"}},t._l(t.colourLevel,function(e){return o("Option",{key:e.value,attrs:{value:e.value}},[o("img",{staticStyle:{width:"100px",height:"14px"},attrs:{src:e.img}}),t._v(t._s(e.value))])}),1)],1)],1),t._v(" "),o("el-divider"),t._v(" "),o("Row",{staticStyle:{margin:"0px"}},[o("el-button",{staticClass:"menubutton",staticStyle:{"margin-top":"-15px","margin-left":"-0.3%","margin-bottom":"2px"},attrs:{type:"primary",size:"small"},on:{click:t.ParameterCalculation}},[t._v(t._s(t.$t("linesMap.setColor.colorCal")))])],1),t._v(" "),o("Table",{attrs:{border:"",size:"small",columns:t.colorColumn,data:t.colorData,height:"320"}})],1),t._v(" "),o("Modal",{attrs:{cancelText:t.$t("button.cancel"),okText:t.$t("button.ok"),draggable:"",title:t.$t("linesMap.setColor.argsModify"),width:"420","z-index":2e3},on:{"on-ok":t.applyReviseCustomColor},model:{value:t.isReviseColorTableVisible,callback:function(e){t.isReviseColorTableVisible=e},expression:"isReviseColorTableVisible"}},[o("Row",{staticStyle:{margin:"5px",border:"solid aliceblue 1px",padding:"5px"}},[o("Col",{attrs:{span:"8"}},[o("Input",{staticStyle:{width:"100px"},model:{value:t.reviseValueForColor,callback:function(e){t.reviseValueForColor=e},expression:"reviseValueForColor"}})],1),t._v(" "),o("Col",{attrs:{span:"4"}},[o("ColorPicker",{attrs:{recommend:""},model:{value:t.reviseCustomColor,callback:function(e){t.reviseCustomColor=e},expression:"reviseCustomColor"}})],1)],1)],1),t._v(" "),o("Content",[o("div",{attrs:{id:t.plotlydivId}})])],1)},staticRenderFns:[]};var u=o("VU/8")(n,c,!1,function(t){o("rxPK")},"data-v-904ca012",null);e.default=u.exports},UwjZ:function(t,e,o){"use strict";const a={gradientColor:null,colorRgb:null,colorHex:null};a.gradientColor=function(t,e,o){var a=this.colorRgb(t),l=a[0],i=a[1],s=a[2],r=this.colorRgb(e),n=r[0]-l,c=r[1]-i,u=r[2]-s,h=[],p=this.colorHex("rgb("+parseInt(n*o+l)+","+parseInt(c*o+i)+","+parseInt(u*o+s)+")");return h.push(p),h},a.colorRgb=function(t){if((t=t.toLowerCase())&&/^#([0-9a-fA-f]{3}|[0-9a-fA-f]{6})$/.test(t)){if(4===t.length){for(var e="#",o=1;o<4;o+=1)e+=t.slice(o,o+1).concat(t.slice(o,o+1));t=e}var a=[];for(o=1;o<7;o+=2)a.push(parseInt("0x"+t.slice(o,o+2)));return a}return t},a.colorHex=function(t){var e=t;if(/^(rgb|RGB)/.test(e)){for(var o=e.replace(/(?:(|)|rgb|RGB)*/g,"").split(","),a="#",l=0;l<o.length;l++){var i=Number(o[l]).toString(16);"0"===(i=i<10?"0"+i:i)&&(i+=i),a+=i}return 7!==a.length&&(a=e),a}if(!/^#([0-9a-fA-f]{3}|[0-9a-fA-f]{6})$/.test(e))return e;var s=e.replace(/#/,"").split("");if(6===s.length)return e;if(3===s.length){var r="#";for(l=0;l<s.length;l+=1)r+=s[l]+s[l];return r}},e.a=a},q00Q:function(t,e,o){(function(o){var a,l,i;l=[],void 0===(i="function"==typeof(a=function(){"use strict";function e(t,e,o){var a=new XMLHttpRequest;a.open("GET",t),a.responseType="blob",a.onload=function(){s(a.response,e,o)},a.onerror=function(){console.error("could not download file")},a.send()}function a(t){var e=new XMLHttpRequest;e.open("HEAD",t,!1);try{e.send()}catch(t){}return 200<=e.status&&299>=e.status}function l(t){try{t.dispatchEvent(new MouseEvent("click"))}catch(o){var e=document.createEvent("MouseEvents");e.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),t.dispatchEvent(e)}}var i="object"==typeof window&&window.window===window?window:"object"==typeof self&&self.self===self?self:"object"==typeof o&&o.global===o?o:void 0,s=i.saveAs||("object"!=typeof window||window!==i?function(){}:"download"in HTMLAnchorElement.prototype?function(t,o,s){var r=i.URL||i.webkitURL,n=document.createElement("a");o=o||t.name||"download",n.download=o,n.rel="noopener","string"==typeof t?(n.href=t,n.origin===location.origin?l(n):a(n.href)?e(t,o,s):l(n,n.target="_blank")):(n.href=r.createObjectURL(t),setTimeout(function(){r.revokeObjectURL(n.href)},4e4),setTimeout(function(){l(n)},0))}:"msSaveOrOpenBlob"in navigator?function(t,o,i){if(o=o||t.name||"download","string"!=typeof t)navigator.msSaveOrOpenBlob(function(t,e){return void 0===e?e={autoBom:!1}:"object"!=typeof e&&(console.warn("Deprecated: Expected third argument to be a object"),e={autoBom:!e}),e.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(t.type)?new Blob(["\ufeff",t],{type:t.type}):t}(t,i),o);else if(a(t))e(t,o,i);else{var s=document.createElement("a");s.href=t,s.target="_blank",setTimeout(function(){l(s)})}}:function(t,o,a,l){if((l=l||open("","_blank"))&&(l.document.title=l.document.body.innerText="downloading..."),"string"==typeof t)return e(t,o,a);var s="application/octet-stream"===t.type,r=/constructor/i.test(i.HTMLElement)||i.safari,n=/CriOS\/[\d]+/.test(navigator.userAgent);if((n||s&&r)&&"object"==typeof FileReader){var c=new FileReader;c.onloadend=function(){var t=c.result;t=n?t:t.replace(/^data:[^;]*;/,"data:attachment/file;"),l?l.location.href=t:location=t,l=null},c.readAsDataURL(t)}else{var u=i.URL||i.webkitURL,h=u.createObjectURL(t);l?l.location=h:location.href=h,l=null,setTimeout(function(){u.revokeObjectURL(h)},4e4)}});i.saveAs=s.saveAs=s,void 0!==t&&(t.exports=s)})?a.apply(e,l):a)||(t.exports=i)}).call(e,o("DuR2"))},rxPK:function(t,e){}});