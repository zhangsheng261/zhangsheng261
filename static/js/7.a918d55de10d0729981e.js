webpackJsonp([7],{enL2:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=i("mvHQ"),o=i.n(a),s=i("/sA3"),l=i("ZpFI"),n={components:{imageExport:i("Yaes").a},props:["dataId","plotlydivId"],data:function(){return{imageFlag:!1,switch_Lines:!0,contourLineSetting:!0,isColourLevelSettingsVisible:!1,colourLevel:[{value:"Rainbow",img:i("aMwd")}],customColor:["#9966FF","#0000FF","#00FF00","#FFFF00","#FF6600","#FF0000"],valueForColor:[],colorData:[],colourLevelModel:"",plotlydiv:null,figure:{title:"专题图名称",xtitle:"Distance/（m）",y1title:"Distance/（m）"},mode_text:"",isFigureVisible:!1,modal1:!1,xlxs_col:[],xlxs_json:[],selectX:"",selectY:"",selectField:"",xGrid:100,yGrid:100,xmin:99999,xmax:0,ymin:99999,ymax:0,plot_data:[{x:[],y:[],values:[],autoscale:!0,zmax:"",zmin:"",type:"scattergl",colorscale:"RdBu",text:[],textposition:"bottom center",mode:"markers"}],layout:{xaxis:{exponentformat:"none",autorange:"false",showline:!0,mirror:"allticks"},yaxis:{exponentformat:"none",autorange:"false",scaleanchor:"x",mirror:"allticks",showline:!0},margin:{t:50,b:80,l:80,r:0},title:window.vm.$i18n.t("pointMap.title"),height:this.getHeight(),width:this.getWidth()},options:{editable:!1},switchOpeConFlag:"展开",dataFromStore:null}},methods:{changeField:function(t){var e=this.xlxs_json;this.plot_data[0].text=[];for(var i=0;i<e.length;i++)this.plot_data[0].text.push(e[i][t].toString());this.$Plotly.react(this.plotlydiv,this.plot_data,this.layout)},change_mode:function(t){var e=void 0;1==t?(0==this.plot_data[0].text.length&&this.$Message.error(window.vm.$i18n.t("pointMap.message")),e={mode:"markers+text"}):e={mode:"markers"};this.$Plotly.update(this.plotlydiv,e,{},0)},switch_cLines:function(t){1==t?(this.$Message.info(window.vm.$i18n.t("pointMap.message1")),this.layout.xaxis.showline=!0,this.layout.yaxis.showline=!0):(this.$Message.info(window.vm.$i18n.t("pointMap.message2")),this.layout.xaxis.showline=!1,this.layout.yaxis.showline=!1),this.$Plotly.react(this.plotlydiv,this.plot_data,this.layout)},changeColourLevel:function(t){this.colourLevelModel=t},applyColourLevelSettings:function(){for(var t=0;t<6;t++)this.colorData.push({value:this.valueForColor[t],color:this.customColor[t]});this.projectTo2D()},changeX:function(t){this.plot_data[0].x=[],this.xmin=this.xlxs_json[0][t],this.xmax=this.xlxs_json[0][t];for(var e,i=0;e=this.xlxs_json[i];i++)this.plot_data[0].x.push(e[t]),this.xmin=this.xmin<e[t]?this.xmin:e[t],this.xmax=this.xmax>e[t]?this.xmax:e[t];this.reLayout(),this.$Plotly.react(this.plotlydiv,this.plot_data,this.layout)},changeY:function(t){this.plot_data[0].y=[],this.ymin=this.xlxs_json[0][t],this.ymax=this.xlxs_json[0][t];for(var e,i=0;e=this.xlxs_json[i];i++)this.plot_data[0].y.push(e[t]),this.ymin=this.ymin<e[t]?this.ymin:e[t],this.ymax=this.ymax>e[t]?this.ymax:e[t];this.reLayout(),this.$Plotly.react(this.plotlydiv,this.plot_data,this.layout)},reLayout:function(){var t=this.getWidth()-80,e=this.getHeight()-130,i=this.xmax-this.xmin,a=this.ymax-this.ymin;if(i/a<=t/e){var o=(t-e*i/a)/2;this.layout.margin.l=80+o,this.layout.margin.r=o,this.layout.margin.t=50,this.layout.margin.b=80}else{var s=(e-t*a/i)/2;this.layout.margin.t=50+s,this.layout.margin.b=80+s,this.layout.margin.l=80,this.layout.margin.r=0}},changeV:function(t){this.plot_data[0].values=[],this.plot_data[0].zmin=this.xlxs_json[0][t],this.plot_data[0].zmax=this.xlxs_json[0][t];for(var e,i=0;e=this.xlxs_json[i];i++)this.plot_data[0].values.push(e[t]),this.plot_data[0].zmin=this.plot_data[0].zmin<e[t]?this.plot_data[0].zmin:e[t],this.plot_data[0].zmax=this.plot_data[0].zmax>e[t]?this.plot_data[0].zmax:e[t]},cancel:function(){},changeColor:function(t){this.plot_data[0].colorscale=t},getWidth:function(){return window.innerWidth-280},getHeight:function(){return window.innerHeight-200},initPage:function(){var t=this.dataId;void 0!=t&&s.a.getJsonFromDatabase(t,this.initPointMap)},initPointMap:function(t){this.$store.state.Global.thematicParams.length>0&&(t.bindX=this.$store.state.Global.thematicParams[0].x,t.bindY=this.$store.state.Global.thematicParams[0].y,this.selectField=this.$store.state.Global.thematicParams[0].p);var e=[],i=[],a=t.data,o=Math.ceil(a.length/5);for(var s in this.xlxs_json=t.data,this.dataFromStore=t,this.xlxs_col=[],a[0])this.xlxs_col.push(s);this.xmin=a[0][t.bindX],this.ymin=a[0][t.bindY],this.xmax=a[0][t.bindX],this.ymax=a[0][t.bindY],this.plot_data[0].zmin=a[0].P,this.plot_data[0].zmax=a[0].P;for(var l,n=0;l=a[n];n++)n%o!=0&&n!=a.length-1||this.valueForColor.push(a[n].P),e.push(l[t.bindX]),i.push(l[t.bindY]),this.xmin=this.xmin<l[t.bindX]?this.xmin:l[t.bindX],this.ymin=this.ymin<l[t.bindY]?this.ymin:l[t.bindY],this.xmax=this.xmax>l[t.bindX]?this.xmax:l[t.bindX],this.ymax=this.ymax>l[t.bindY]?this.ymax:l[t.bindY];this.selectX=t.bindX,this.selectY=t.bindY,this.plot_data[0].x=e,this.plot_data[0].y=i,this.reLayout(),this.plotlydiv=document.getElementById(this.plotlydivId),this.$Plotly.newPlot(this.plotlydiv,this.plot_data,this.layout,{displaylogo:!1})},switchOpeStatus:function(){"展开"==this.switchOpeConFlag?(this.$refs.opeConRef.style.width="0",this.$refs.opeConRef.style.overflow="hidden",this.switchOpeConFlag="隐藏"):"隐藏"==this.switchOpeConFlag&&(this.$refs.opeConRef.style.width="unset",this.$refs.opeConRef.style.overflow="unset",this.switchOpeConFlag="展开")},projectToMap:function(t){""!=this.selectField?"projectTo2D"==t?this.isColourLevelSettingsVisible=!0:this.projectTo3D():this.$Notice.warning({title:window.vm.$i18n.t("layer.tips"),desc:window.vm.$i18n.t("pointMap.message3")})},projectTo2D:function(){var t=this;"Null"==t.dataFromStore.spatialReference&&s.a.getJsonFromDatabase(t.dataId,function(e){t.dataFromStore=e,"Null"!=t.dataFromStore.spatialReference||t.$message({type:"warning",message:window.vm.$i18n.t("message.noCoornate")})}),s.a.changeSpatialReference(t.dataFromStore.spatialReference);var e,i=[],a=void 0,n=[],r=[];e=Math.ceil(t.dataFromStore.data.length/t.customColor.length);for(var c=0,h=t.dataFromStore.data.length;c<h;c++)r.push(parseFloat(t.dataFromStore.data[c][t.selectField]));r.sort(function(t,e){return t-e});var p=1;for(h=t.customColor.length;p<=h;p++)p==h?n.push(parseFloat(r[r.length-1])):n.push(parseFloat(r[p*e-1]));n.sort(function(t,e){return t-e});for(var d=0;d<t.dataFromStore.data.length;d++){var u=t.dataFromStore.data[d],m=[u[t.selectX],u[t.selectY]],g=t.ol.proj.transform(m,t.dataFromStore.spatialReference,"EPSG:4326"),x=new t.ol.Feature({geometry:new t.ol.geom.Point(g),name:t.selectField+": "+(1*u[t.selectField]).toFixed(2)}),y=0;for(h=t.customColor.length;y<h;y++)if(parseFloat(u[t.selectField])<=n[y]){a=t.customColor[y];break}x.setStyle(new t.ol.style.Style({text:new t.ol.style.Text({text:t.selectField+": "+(1*u[t.selectField]).toFixed(2),offsetX:30,offsetY:-10,fill:new t.ol.style.Fill({color:a})}),image:new t.ol.style.Circle({radius:3,fill:new t.ol.style.Fill({color:a})})})),i.push(x)}var v=l.a.treeData2d[1].children.map(function(t){return t.id});v.sort(function(t,e){return t-e});var f=100+Math.floor(10*Math.random());0!=v.length&&(f=v[v.length-1]+1);var _=new t.ol.source.Vector,w=new t.ol.layer.Vector({source:_,id:f});t.$store.state.Global.map2DHandler.addLayer(w),_.addFeatures(i),t.$store.state.Global.map2DHandler.getView().fit(_.getExtent());var b=(new t.ol.format.GeoJSON).writeFeatures(i),F={};F.id=f,F.layerObj=_,F.label=window.vm.$i18n.t("pointMap.title")+"_"+t.dataFromStore.displayName,F.geometry="point",F.shareObj={json:b,colorConfig:o()(n)},l.a.treeData2d[1].children.push(F),t.$store.state.Global.twoDTempLayers.push(w),t.$nextTick(function(){t.$store.state.Global.twoDLayerTree.setChecked(f,!0,!1)}),t.$store.state.Global.activeTabValue="二维地图"},openFigureTable:function(){this.isFigureVisible=!0},changeFigure:function(){var t={title:this.figure.title,"xaxis.title":this.figure.xtitle,"yaxis.title":this.figure.y1title};this.$Plotly.relayout(this.plotlydiv,t)},showModal:function(){this.imageFlag=!0},closeModal:function(t){this.imageFlag=t}},watch:{},computed:{thematicFlag:function(){return this.$store.state.Global.thematicFlag}},mounted:function(){this.initPage()}},r={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"layout"},[i("Layout",[i("div",{staticClass:"headerOpeBanner"},[i("el-button",{staticClass:"switchContainer",staticStyle:{padding:"5px 10px"},attrs:{plain:"",size:"mini",title:"菜单 展开/收缩"},on:{click:t.switchOpeStatus}},[i("i",{staticClass:"el-icon-arrow-left",class:{transition:"展开"!=this.switchOpeConFlag}})]),t._v(" "),i("div",{ref:"opeConRef",staticClass:"operationContainerWrap"},[i("div",{staticClass:"counterMenuGroup operationContainer",style:{width:.7*this.getWidth()+"px"}},[t._v("\n          X："),i("Select",{staticStyle:{width:"80px","margin-right":"5px"},on:{"on-change":t.changeX},model:{value:t.selectX,callback:function(e){t.selectX=e},expression:"selectX"}},t._l(t.xlxs_col,function(e){return i("Option",{key:e,attrs:{value:e}},[t._v(t._s(e))])}),1),t._v("\n          Y："),i("Select",{staticStyle:{width:"80px","margin-right":"5px"},on:{"on-change":t.changeY},model:{value:t.selectY,callback:function(e){t.selectY=e},expression:"selectY"}},t._l(t.xlxs_col,function(e){return i("Option",{key:e,attrs:{value:e}},[t._v(t._s(e))])}),1),t._v("\n          "+t._s(t.$t("pointMap.projection"))+" "),i("Select",{staticStyle:{width:"80px","margin-right":"5px"},on:{"on-change":t.changeField},model:{value:t.selectField,callback:function(e){t.selectField=e},expression:"selectField"}},t._l(t.xlxs_col,function(e){return i("Option",{key:e,attrs:{value:e}},[t._v(t._s(e))])}),1),t._v(" "),i("Dropdown",{on:{"on-click":t.projectToMap}},[i("el-button",{staticStyle:{width:"80px","margin-right":"10px","margin-top":"1px",height:"30px"},attrs:{size:"mini",type:"primary"}},[t._v("\n                "+t._s(t.$t("pointMap.project"))+"\n                "),i("Icon",{attrs:{type:"ios-arrow-down"}})],1),t._v(" "),i("DropdownMenu",{attrs:{slot:"list"},slot:"list"},[i("DropdownItem",{attrs:{name:"projectTo2D"}},[t._v(t._s(t.$t("pointMap.projectTo2D")))])],1)],1),t._v(" "),t.thematicFlag?i("el-button",{staticStyle:{width:"80px","margin-right":"10px","margin-top":"1px",height:"30px"},attrs:{type:"primary",size:"mini"},on:{click:t.openFigureTable}},[t._v(t._s(t.$t("pointMap.styleModify.title"))+"\n          ")]):t._e(),t._v(" "),i("span",[t.contourLineSetting?i("span",[t._v("\n                    "+t._s(t.$t("pointMap.outline"))+"\n                    "),i("i-switch",{on:{"on-change":t.switch_cLines},model:{value:t.switch_Lines,callback:function(e){t.switch_Lines=e},expression:"switch_Lines"}})],1):t._e()]),t._v(" "),i("span",[t._v("\n                    "+t._s(t.$t("pointMap.taggingShow"))+"\n                    "),i("i-switch",{on:{"on-change":t.change_mode},model:{value:t.mode_text,callback:function(e){t.mode_text=e},expression:"mode_text"}})],1),t._v("\n           \n          "),i("el-button",{staticStyle:{"margin-right":"10px"},attrs:{type:"primary",size:"mini"},on:{click:t.showModal}},[t._v("\n            "+t._s(t.$t("pointMap.exportImage"))+"\n          ")])],1),t._v(" "),i("Modal",{attrs:{cancelText:t.$t("button.cancel"),okText:t.$t("button.ok"),draggable:"",title:t.$t("pointMap.styleModify.title"),width:"420"},on:{"on-ok":t.changeFigure},model:{value:t.isFigureVisible,callback:function(e){t.isFigureVisible=e},expression:"isFigureVisible"}},[i("Row",{staticStyle:{margin:"5px",border:"solid aliceblue 1px",padding:"5px"}},[i("el-row",{staticStyle:{"margin-bottom":"10px"},attrs:{gutter:5,type:"flex"}},[i("el-col",{attrs:{span:2}}),t._v(" "),i("el-col",{attrs:{span:6}},[i("span",{staticClass:"geo-dialog-lable"},[t._v(t._s(t.$t("pointMap.styleModify.name")))])]),t._v(" "),i("el-col",{attrs:{span:14}},[i("el-input",{attrs:{size:"small"},model:{value:t.figure.title,callback:function(e){t.$set(t.figure,"title",e)},expression:"figure.title"}})],1)],1),t._v(" "),i("el-row",{staticStyle:{"margin-bottom":"10px"},attrs:{gutter:5,type:"flex"}},[i("el-col",{attrs:{span:2}}),t._v(" "),i("el-col",{attrs:{span:6}},[i("span",{staticClass:"geo-dialog-lable"},[t._v(t._s(t.$t("pointMap.styleModify.X1Title")))])]),t._v(" "),i("el-col",{attrs:{span:14}},[i("el-input",{attrs:{size:"small"},model:{value:t.figure.xtitle,callback:function(e){t.$set(t.figure,"xtitle",e)},expression:"figure.xtitle"}})],1)],1),t._v(" "),i("el-row",{staticStyle:{"margin-bottom":"10px"},attrs:{gutter:5,type:"flex"}},[i("el-col",{attrs:{span:2}}),t._v(" "),i("el-col",{attrs:{span:6}},[i("span",{staticClass:"geo-dialog-lable"},[t._v(t._s(t.$t("pointMap.styleModify.Y1Title")))])]),t._v(" "),i("el-col",{attrs:{span:14}},[i("el-input",{attrs:{size:"small"},model:{value:t.figure.y1title,callback:function(e){t.$set(t.figure,"y1title",e)},expression:"figure.y1title"}})],1)],1)],1)],1),t._v(" "),i("Modal",{attrs:{draggable:"",title:t.$t("point.colorSetTitle"),width:"420"},on:{"on-ok":t.applyColourLevelSettings},model:{value:t.isColourLevelSettingsVisible,callback:function(e){t.isColourLevelSettingsVisible=e},expression:"isColourLevelSettingsVisible"}},[i("Row",{staticStyle:{margin:"5px",border:"solid aliceblue 1px",padding:"5px"}},[i("Col",{attrs:{span:"8"}},[i("P",{staticStyle:{"font-size":"15px","margin-top":"5px"}},[t._v(t._s(t.$t("point.colorSet")))])],1),t._v(" "),i("Col",[i("Select",{staticStyle:{width:"200px"},on:{"on-change":t.changeColourLevel},model:{value:t.colourLevelModel,callback:function(e){t.colourLevelModel=e},expression:"colourLevelModel"}},t._l(t.colourLevel,function(e){return i("Option",{key:e.value,attrs:{value:e.value}},[i("img",{attrs:{src:e.img}}),t._v(t._s(e.value))])}),1)],1)],1)],1)],1)],1),t._v(" "),i("Content",{style:{background:"#fff"}},[i("div",{attrs:{id:t.plotlydivId}})])],1),t._v(" "),i("imageExport",{attrs:{imageConfigShow:t.imageFlag,plotlyDiv:t.plotlydiv},on:{closeModal:t.closeModal}})],1)},staticRenderFns:[]};var c=i("VU/8")(n,r,!1,function(t){i("qjou")},"data-v-953dd39e",null);e.default=c.exports},qjou:function(t,e){}});