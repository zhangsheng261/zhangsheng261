webpackJsonp([6],{"0y4O":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=i("/sA3"),a=i("ZpFI"),l=i("Yaes"),o=(i("BmLr"),{components:{imageExport:l.a},props:["dataId","plotlydivId"],data:function(){return{imageFlag:!1,contourLineSetting:!0,switch_Lines:!0,plotlydiv:null,url:i("tdi3"),switchOpeConFlag:"展开",dialogVisible:!1,field:"",xlxs_col:[],xlxs_json:[],ratio:1.1,plot_data:[{x:[3,3,3],y:[2,3,4],type:"scatter",colorscale:"RdBu"}],xmin:99999,xmax:0,ymin:99999,ymax:0,layout:{margin:{t:50,b:80,l:80,r:200},xaxis:{exponentformat:"none",autorange:"false",hoverformat:"s",showexponent:"none",showline:!0,mirror:"allticks"},yaxis:{showline:!0,mirror:"allticks",exponentformat:"none",autorange:"false",scaleanchor:"x"},showlegend:!1,height:this.getHeight(),width:this.getWidth()},options:{editable:!1},figure:{title:"专题图名称",xtitle:"Distance/（m）",y1title:"Distance/（m）"},dataFromStore:null,isFigureVisible:!1,pointNumber:"",lineNumber:"",xField:"",yField:""}},methods:{switch_cLines:function(t){1==t?(this.$Message.info(window.vm.$i18n.t("sectionMap.message1")),this.layout.xaxis.showline=!0,this.layout.yaxis.showline=!0):(this.$Message.info(window.vm.$i18n.t("sectionMap.message2")),this.layout.xaxis.showline=!1,this.layout.yaxis.showline=!1),this.$Plotly.relayout(this.plotlydiv,this.layout)},showDialog:function(){this.dialogVisible=!0},ChangeRATIO:function(t){this.ratio=t,this.ok()},ok:function(){if(""==this.field||""==this.xField||""==this.yField||""==this.lineNumber||""==this.pointNumber)this.$Message.error("字段配置异常");else if(isNaN(this.ratio))this.$Message.error("系数设置错误");else{var t=this,e=this.xlxs_json,i=this.field,s=this.xField,a=this.yField,l=this.lineNumber,o=this.pointNumber,n=1*(e=e.sort(function(t,e){return t[l]==e[l]?t[o]-e[o]:t[l]-e[l]}))[e.length-1][s],r=1*e[e.length-1][a];this.xmin=n,this.xmax=n,this.ymin=r,this.ymax=r;var c=[],h=-99389,p=this.ratio,u=(1*e[1][a]-1*e[0][a])/(1*e[1][s]-1*e[0][s]);t.$store.state.Global.progressVisible=!0;for(var d=e.length-1;d>=0;d--){d%100==0&&(this.$store.state.Global.percent=d/e.length*100>100?100:d/e.length*50),h=1*e[d][l];var g=[],f=[],m=[],y=0,x=0;for(d<e.length-2&&h!=e[d+1][l]&&(n=1*e[d][s],r=1*e[d][a]),this.xmin=this.xmin<n?this.xmin:n,this.xmax=this.xmax>n?this.xmax:n,this.ymin=this.ymin<r?this.ymin:r,this.ymax=this.ymax>r?this.ymax:r,g.push(n),f.push(r),y=1*e[d][s]+e[d][i]*Math.abs(Math.sin(Math.atan(u)))*p,x=1*e[d][a]+e[d][i]*Math.cos(Math.atan(u))*p,g.push(y),f.push(x),m.push(1*e[d][i]);null!=e[d-1]&&e[d][l]==e[d-1][l]&&e[d][i]*e[d-1][i]>0;)e[--d][s]!=e[d+1][s]&&(y=1*e[d][s]+e[d][i]*Math.abs(Math.sin(Math.atan(u)))*p,x=1*e[d][a]+e[d][i]*Math.cos(Math.atan(u))*p,g.push(y),f.push(x),m.push(1*e[d][i]));if(null==e[d-1]||e[d][l]!=e[d-1][l]?(g.push(1*e[d][s]),f.push(1*e[d][a]),this.xmin=this.xmin<1*e[d][s]?this.xmin:1*e[d][s],this.xmax=this.xmax>1*e[d][s]?this.xmax:1*e[d][s],this.ymin=this.ymin<1*e[d][a]?this.ymin:1*e[d][a],this.ymax=this.ymax>1*e[d][a]?this.ymax:1*e[d][a]):(n=(1*e[d][s]+1*e[d-1][s])/2,r=(1*e[d][a]+1*e[d-1][a])/2,g.push(n),f.push(r)),1*e[d][i]<0){var v={x:g,y:f,type:"scatter",fill:"toself",fillcolor:"blue",name:"线号"+e[d][l],mode:"lines",hovertext:m,hoverinfo:"all",line:{width:.8,smoothing:1.3,shape:"spline",color:"black"}};c.push(v)}else{var b={x:g,y:f,fill:"toself",fillcolor:"red",text:m,name:"线号"+e[d][l],type:"scatter",mode:"lines",hoverinfo:"all",line:{width:.8,smoothing:1.3,shape:"spline",color:"black"}};c.push(b)}}this.reLayout(),this.plotlydiv=document.getElementById(this.plotlydivId),this.$Plotly.newPlot(this.plotlydiv,c,this.layout,{displaylogo:!1}),this.dialogVisible=!1,setTimeout(function(){t.$store.state.Global.percent=100},1e3),setTimeout(function(){t.$store.state.Global.progressVisible=!1},2e3)}},reLayout:function(){var t=this.getWidth()-80,e=this.getHeight()-130,i=this.xmax-this.xmin,s=this.ymax-this.ymin;if(i/s<=t/e){var a=(t-e*i/s)/2;this.layout.margin.l=80+a,this.layout.margin.t=50,this.layout.margin.b=80}else{var l=(e-t*s/i)/2;this.layout.margin.t=50+l,this.layout.margin.b=80+l,this.layout.margin.l=80}},close:function(){this.dialogVisible=!1},getWidth:function(){return window.innerWidth-260},getHeight:function(){return window.innerHeight-130-30-31},initPage:function(){var t=this.dataId;void 0!=t&&s.a.getJsonFromDatabase(t,this.initSectionMap)},initSectionMap:function(t){this.xField=t.bindX,this.yField=t.bindY;var e=t.data;for(var i in this.dataFromStore=t,this.xlxs_json=e,this.xlxs_col=[],e[0])this.xlxs_col.push(i);this.$store.state.Global.thematicFlag?(this.xField=this.$store.state.Global.thematicParams[0].xField,this.yField=this.$store.state.Global.thematicParams[0].yField,this.pointNumber=this.$store.state.Global.thematicParams[0].pointNumber,this.lineNumber=this.$store.state.Global.thematicParams[0].lineNumber,this.field=this.$store.state.Global.thematicParams[0].field,this.ok()):this.dialogVisible=!0},changeV:function(t){this.field=t},switchOpeStatus:function(){"展开"==this.switchOpeConFlag?(this.$refs.opeConRef.style.width="0",this.$refs.opeConRef.style.overflow="hidden",this.switchOpeConFlag="隐藏"):"隐藏"==this.switchOpeConFlag&&(this.$refs.opeConRef.style.width="unset",this.$refs.opeConRef.style.overflow="unset",this.switchOpeConFlag="展开")},projectToMap:function(){var t=this,e=this;"Null"==e.dataFromStore.spatialReference&&s.a.getJsonFromDatabase(e.dataId,function(t){e.dataFromStore=t,"Null"!=e.dataFromStore.spatialReference||e.$message({type:"warning",message:window.vm.$i18n.t("message.noCoornate")})});var i=e.dataFromStore.data,l=[];i.forEach(function(t){-1==l.indexOf(t.L)&&l.push(t.L)}),l.sort(r,function(t){return r-t}),l.reverse();for(var o,n=[],r=0;o=l[r++];){for(var c,h=[],p=0;c=i[p++];)c.L==o&&h.push(c);n.push(h)}var u={type:"FeatureCollection",features:[]};s.a.changeSpatialReference(e.dataFromStore.spatialReference),n.forEach(function(i){i.sort(function(t,e){return t.X-e.X});for(var s=(i[0].Y-i[3].Y)/(i[0].X-i[3].X),a=[],l=[],o=!1,n=0;n<i.length-1;n++){var r=i[n],c=i[n+1];if(r[e.field]*c[e.field]>0)if(1*r[e.field]>0){o||(a.push({x:i[0].X,y:i[0].Y}),o=!0);var h=Math.sqrt(r[e.field]*r[e.field]*e.ratio*e.ratio/(1+-1/s*(-1/s)))+r.X,p=-1/s*Math.sqrt(r[e.field]*r[e.field]*e.ratio*e.ratio/(1+-1/s*(-1/s)))+r.Y;a.push({x:h,y:p})}else{o||(l.push({x:i[0].X,y:i[0].Y}),o=!0);h=-Math.sqrt(r[e.field]*r[e.field]*e.ratio*e.ratio/(1+-1/s*(-1/s)))+r.X,p=1/s*Math.sqrt(r[e.field]*r[e.field]*e.ratio*e.ratio/(1+-1/s*(-1/s)))+r.Y;l.push({x:h,y:p})}else if(1*r[e.field]>0){a.push({x:(r.X+c.X)/2,y:(r.Y+c.Y)/2});for(var d=[],g=0;b=a[g++];){var f=[b.x,b.y],m=t.ol.proj.transform(f,e.dataFromStore.spatialReference,"EPSG:4326");d.push(m)}var y={type:"Feature",properties:{type:"up"},geometry:{type:"Polygon",coordinates:[d]}};u.features.push(y),a=[],(l=[]).push({x:(r.X+c.X)/2,y:(r.Y+c.Y)/2})}else{l.push({x:(r.X+c.X)/2,y:(r.Y+c.Y)/2});for(d=[],g=0;b=l[g++];){f=[b.x,b.y];var x=e.ol.proj.transform(f,e.dataFromStore.spatialReference,"EPSG:4326");d.push(x)}y={type:"Feature",properties:{type:"down"},geometry:{type:"Polygon",coordinates:[d]}};u.features.push(y),l=[],(a=[]).push({x:(r.X+c.X)/2,y:(r.Y+c.Y)/2})}}if(1*i[i.length-1][e.field]>0){h=Math.sqrt(i[i.length-1][e.field]*i[i.length-1][e.field]*e.ratio*e.ratio/(1+-1/s*(-1/s)))+i[i.length-1].X,p=-1/s*Math.sqrt(i[i.length-1][e.field]*i[i.length-1][e.field]*e.ratio*e.ratio/(1+-1/s*(-1/s)))+i[i.length-1].Y;a.push({x:h,y:p}),a.push({x:i[i.length-1].X,y:i[i.length-1].Y});for(d=[],g=0;b=a[g++];){f=[b.x,b.y];var v=e.ol.proj.transform(f,e.dataFromStore.spatialReference,"EPSG:4326");d.push(v)}y={type:"Feature",properties:{type:"up"},geometry:{type:"Polygon",coordinates:[d]}};u.features.push(y)}else if(1*i[i.length-1][e.field]<0){h=-Math.sqrt(i[i.length-1][e.field]*i[i.length-1][e.field]*e.ratio*e.ratio/(1+-1/s*(-1/s)))+i[i.length-1].X,p=1/s*Math.sqrt(i[i.length-1][e.field]*i[i.length-1][e.field]*e.ratio*e.ratio/(1+-1/s*(-1/s)))+i[i.length-1].Y;l.push({x:h,y:p}),l.push({x:i[i.length-1].X,y:i[i.length-1].Y});var b;for(d=[],g=0;b=l[g++];){f=[b.x,b.y];var _=e.ol.proj.transform(f,e.dataFromStore.spatialReference,"EPSG:4326");d.push(_)}y={type:"Feature",properties:{type:"down"},geometry:{type:"Polygon",coordinates:[d]}};u.features.push(y)}});var d=new e.ol.style.Fill,g=new e.ol.style.Style({fill:d,stroke:new e.ol.style.Stroke({color:"#333",width:1})}),f=new e.ol.style.Fill,m=(new e.ol.style.Style({fill:f,stroke:new e.ol.style.Stroke({color:"#333",width:1})}),a.a.treeData2d[1].children.map(function(t){return t.id}));m.sort(function(t,e){return t-e});var y=100+Math.floor(10*Math.random());0!=m.length&&(y=m[m.length-1]+1);var x=new e.ol.source.Vector({features:(new e.ol.format.GeoJSON).readFeatures(u)}),v=new e.ol.layer.Vector({source:x,style:function(t){return"up"==t.get("type")?d.setColor("red"):d.setColor("blue"),g},id:y});e.$store.state.Global.map2DHandler.addLayer(v),e.$store.state.Global.map2DHandler.getView().fit(x.getExtent()),e.$store.state.Global.activeTabValue="二维地图";var b={};b.id=y,b.label=window.vm.$i18n.t("sectionMap.title")+e.dataFromStore.displayName,b.layerObj=x,b.shareObj={json:u,colorConfig:""},a.a.treeData2d[1].children.push(b),e.$nextTick(function(){e.$store.state.Global.twoDLayerTree.setChecked(y,!0,!1)})},openFigureTable:function(){this.isFigureVisible=!0},changeFigure:function(){var t={title:this.figure.title,"xaxis.title":this.figure.xtitle,"yaxis.title":this.figure.y1title};this.$Plotly.relayout(this.plotlydiv,t)},showModal:function(){this.imageFlag=!0},closeModal:function(t){this.imageFlag=t}},mounted:function(){this.initPage()},computed:{thematicFlag:function(){return this.$store.state.Global.thematicFlag}}}),n={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"layout"},[i("Layout",[i("div",{staticClass:"headerOpeBanner"},[i("el-button",{staticClass:"switchContainer",staticStyle:{padding:"5px 10px"},attrs:{plain:"",size:"mini",title:"菜单 展开/收缩"},on:{click:t.switchOpeStatus}},[i("i",{staticClass:"el-icon-arrow-left",class:{transition:"展开"!=this.switchOpeConFlag}})]),t._v(" "),i("div",{ref:"opeConRef",staticClass:"operationContainerWrap"},[i("div",{staticClass:" counterMenuGroup operationContainer",style:{width:.65*this.getWidth()+"px"}},[t.thematicFlag?i("el-button",{staticClass:"menubutton",staticStyle:{"margin-left":"10px"},attrs:{type:"primary",size:"mini"},on:{click:t.openFigureTable}},[t._v(t._s(t.$t("sectionMap.styleModify.title")))]):t._e(),t._v(" "),i("el-button",{staticStyle:{display:"inline-block","margin-left":"5px"},attrs:{type:"primary",size:"mini"},on:{click:t.showDialog}},[t._v(t._s(t.$t("sectionMap.args.name")))]),t._v(" "),i("el-button",{staticStyle:{display:"inline-block"},attrs:{type:"primary",size:"mini"},on:{click:t.projectToMap}},[t._v(t._s(t.$t("sectionMap.project")))]),t._v(" "),i("span",[t.contourLineSetting?i("span",[t._v("\n                          "+t._s(t.$t("sectionMap.outline"))+"\n                          "),i("i-switch",{on:{"on-change":t.switch_cLines},model:{value:t.switch_Lines,callback:function(e){t.switch_Lines=e},expression:"switch_Lines"}})],1):t._e()]),t._v("\n                   \n                  "),i("el-button",{staticStyle:{"margin-right":"10px"},attrs:{type:"primary",size:"mini"},on:{click:t.showModal}},[t._v("\n                    "+t._s(t.$t("sectionMap.exportImage"))+"\n                  ")])],1)])],1),t._v(" "),i("el-row",{attrs:{type:"flex",gutter:0}},[i("el-col",{attrs:{span:21}},[i("Content",{style:{background:"#fff"}},[i("div",{staticClass:"plotly-div-point",attrs:{id:t.plotlydivId}})])],1),t._v(" "),i("el-col",{staticStyle:{background:"#fff"},attrs:{span:3}},[i("el-image",{staticStyle:{position:"absolute",width:"200px",height:"128px",right:"5px",bottom:"100px"},attrs:{src:t.url}})],1)],1)],1),t._v(" "),i("Modal",{attrs:{title:t.$t("sectionMap.args.title"),mask:!1,width:"27%"},model:{value:t.dialogVisible,callback:function(e){t.dialogVisible=e},expression:"dialogVisible"}},[i("el-row",{staticStyle:{"margin-bottom":"20px"},attrs:{gutter:5,type:"flex"}},[i("el-col",{attrs:{span:2}}),t._v(" "),i("el-col",{attrs:{span:6}},[i("span",{staticClass:"geo-dialog-lable"},[t._v(t._s(t.$t("sectionMap.args.xField")))])]),t._v(" "),i("el-col",{attrs:{span:10}},[i("Select",{model:{value:t.xField,callback:function(e){t.xField=e},expression:"xField"}},t._l(t.xlxs_col,function(e){return i("Option",{key:e,attrs:{value:e}},[t._v(t._s(e))])}),1)],1)],1),t._v(" "),i("el-row",{staticStyle:{"margin-bottom":"20px"},attrs:{gutter:5,type:"flex"}},[i("el-col",{attrs:{span:2}}),t._v(" "),i("el-col",{attrs:{span:6}},[i("span",{staticClass:"geo-dialog-lable"},[t._v(t._s(t.$t("sectionMap.args.yField")))])]),t._v(" "),i("el-col",{attrs:{span:10}},[i("Select",{model:{value:t.yField,callback:function(e){t.yField=e},expression:"yField"}},t._l(t.xlxs_col,function(e){return i("Option",{key:e,attrs:{value:e}},[t._v(t._s(e))])}),1)],1)],1),t._v(" "),i("el-row",{staticStyle:{"margin-bottom":"20px"},attrs:{gutter:5,type:"flex"}},[i("el-col",{attrs:{span:2}}),t._v(" "),i("el-col",{attrs:{span:6}},[i("span",{staticClass:"geo-dialog-lable"},[t._v(t._s(t.$t("sectionMap.args.lineNumber")))])]),t._v(" "),i("el-col",{attrs:{span:10}},[i("Select",{model:{value:t.lineNumber,callback:function(e){t.lineNumber=e},expression:"lineNumber"}},t._l(t.xlxs_col,function(e){return i("Option",{key:e,attrs:{value:e}},[t._v(t._s(e))])}),1)],1)],1),t._v(" "),i("el-row",{staticStyle:{"margin-bottom":"20px"},attrs:{gutter:5,type:"flex"}},[i("el-col",{attrs:{span:2}}),t._v(" "),i("el-col",{attrs:{span:6}},[i("span",{staticClass:"geo-dialog-lable"},[t._v(t._s(t.$t("sectionMap.args.pointNumber")))])]),t._v(" "),i("el-col",{attrs:{span:10}},[i("Select",{model:{value:t.pointNumber,callback:function(e){t.pointNumber=e},expression:"pointNumber"}},t._l(t.xlxs_col,function(e){return i("Option",{key:e,attrs:{value:e}},[t._v(t._s(e))])}),1)],1)],1),t._v(" "),i("el-row",{staticStyle:{"margin-bottom":"20px"},attrs:{gutter:5,type:"flex"}},[i("el-col",{attrs:{span:2}}),t._v(" "),i("el-col",{attrs:{span:6}},[i("span",{staticClass:"geo-dialog-lable"},[t._v(t._s(t.$t("sectionMap.args.field")))])]),t._v(" "),i("el-col",{attrs:{span:10}},[i("Select",{model:{value:t.field,callback:function(e){t.field=e},expression:"field"}},t._l(t.xlxs_col,function(e){return i("Option",{key:e,attrs:{value:e}},[t._v(t._s(e))])}),1)],1)],1),t._v(" "),i("el-row",{staticStyle:{"margin-bottom":"20px"},attrs:{gutter:5,type:"flex"}},[i("el-col",{attrs:{span:2}}),t._v(" "),i("el-col",{attrs:{span:6}},[i("span",{staticClass:"geo-dialog-lable"},[t._v(t._s(t.$t("sectionMap.args.coefficient")))])]),t._v(" "),i("el-col",{attrs:{span:10}},[i("el-input",{attrs:{size:"small"},model:{value:t.ratio,callback:function(e){t.ratio=e},expression:"ratio"}})],1)],1),t._v(" "),i("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{on:{click:t.close}},[t._v(t._s(t.$t("button.cancel")))]),t._v(" "),i("el-button",{attrs:{type:"primary"},on:{click:t.ok}},[t._v(t._s(t.$t("button.ok")))])],1)],1),t._v(" "),i("Modal",{attrs:{draggable:"",title:t.$t("sectionMap.styleModify.title"),width:"420"},on:{"on-ok":t.changeFigure},model:{value:t.isFigureVisible,callback:function(e){t.isFigureVisible=e},expression:"isFigureVisible"}},[i("Row",{staticStyle:{margin:"5px",border:"solid aliceblue 1px",padding:"5px"}},[i("el-row",{staticStyle:{"margin-bottom":"10px"},attrs:{gutter:5,type:"flex"}},[i("el-col",{attrs:{span:2}}),t._v(" "),i("el-col",{attrs:{span:6}},[i("span",{staticClass:"geo-dialog-lable"},[t._v(t._s(t.$t("sectionMap.styleModify.name")))])]),t._v(" "),i("el-col",{attrs:{span:14}},[i("el-input",{attrs:{size:"small"},model:{value:t.figure.title,callback:function(e){t.$set(t.figure,"title",e)},expression:"figure.title"}})],1)],1),t._v(" "),i("el-row",{staticStyle:{"margin-bottom":"10px"},attrs:{gutter:5,type:"flex"}},[i("el-col",{attrs:{span:2}}),t._v(" "),i("el-col",{attrs:{span:6}},[i("span",{staticClass:"geo-dialog-lable"},[t._v(t._s(t.$t("sectionMap.styleModify.X1Title")))])]),t._v(" "),i("el-col",{attrs:{span:14}},[i("el-input",{attrs:{size:"small"},model:{value:t.figure.xtitle,callback:function(e){t.$set(t.figure,"xtitle",e)},expression:"figure.xtitle"}})],1)],1),t._v(" "),i("el-row",{staticStyle:{"margin-bottom":"10px"},attrs:{gutter:5,type:"flex"}},[i("el-col",{attrs:{span:2}}),t._v(" "),i("el-col",{attrs:{span:6}},[i("span",{staticClass:"geo-dialog-lable"},[t._v(t._s(t.$t("sectionMap.styleModify.Y1Title")))])]),t._v(" "),i("el-col",{attrs:{span:14}},[i("el-input",{attrs:{size:"small"},model:{value:t.figure.y1title,callback:function(e){t.$set(t.figure,"y1title",e)},expression:"figure.y1title"}})],1)],1)],1)],1),t._v(" "),i("imageExport",{attrs:{imageConfigShow:t.imageFlag,plotlyDiv:t.plotlydiv},on:{closeModal:t.closeModal}})],1)},staticRenderFns:[]};var r=i("VU/8")(o,n,!1,function(t){i("5Tge")},"data-v-5ee8eb27",null);e.default=r.exports},"5Tge":function(t,e){},tdi3:function(t,e,i){t.exports=i.p+"static/img/legend.b518ae3.png"}});